grafana:
  deploymentStrategy:
    type: Recreate
  datasources:
   datasources.yaml:
     apiVersion: 1
     datasources:
     - name: Prometheus
       type: prometheus
       url: http://monitoring-prometheus-server
       access: proxy
       uid: prometheus
  dashboardProviders:
    dashboardproviders.yaml:
      apiVersion: 1
      providers:
      - name: 'default'
        orgId: 1
        folder: ''
        type: file
        disableDeletion: false
        editable: true
        options:
          path: /var/lib/grafana/dashboards/default
  dashboards:
    default:
      node-exporter-full:
        gnetId: 1860
        revision: 33
        datasource: Prometheus
      prometheus-2-0-overview:
        gnetId: 3662
        revision: 2
        datasource: Prometheus
      nginx-ingress-controller:
        gnetId: 9614
        revision: 1
        datasource: Prometheus
      simple-server-dashboard-k8s:
        url: https://raw.githubusercontent.com/simpledotorg/container-deployment/local-govind/assets/grafana-dashboards/simple-server.json
        token: ''
      pgmonitor-pgbackrest:
        url: https://raw.githubusercontent.com/simpledotorg/container-deployment/local-govind/assets/grafana-dashboards/pgMonitor/pgbackrest.json
        token: ''
      pgmonitor-pod-details:
        url: https://raw.githubusercontent.com/simpledotorg/container-deployment/local-govind/assets/grafana-dashboards/pgMonitor/pod_details.json
        token: ''
      pgmonitor-postgresql-details:
        url: https://raw.githubusercontent.com/simpledotorg/container-deployment/local-govind/assets/grafana-dashboards/pgMonitor/postgresql_details.json
        token: ''
      pgmonitor-postgresql-overview:
        url: https://raw.githubusercontent.com/simpledotorg/container-deployment/local-govind/assets/grafana-dashboards/pgMonitor/postgresql_overview.json
        token: ''
      pgmonitor-postgresql-service-health:
        url: https://raw.githubusercontent.com/simpledotorg/container-deployment/local-govind/assets/grafana-dashboards/pgMonitor/postgresql_service_health.json
        token: ''
      pgmonitor-prometheus-alerts:
        url: https://raw.githubusercontent.com/simpledotorg/container-deployment/local-govind/assets/grafana-dashboards/pgMonitor/prometheus_alerts.json
        token: ''
      pgmonitor-query-statistics:
        url: https://raw.githubusercontent.com/simpledotorg/container-deployment/local-govind/assets/grafana-dashboards/pgMonitor/query_statistics.json
        token: ''
      redis-monitoring:
        gnetId: 11835
        revision: 1
        datasource: Prometheus
      postgres-monitoring:
        gnetId: 9628
        revision: 1
        datasource: Prometheus
prometheus:
  alertmanager:
    extraSecretMounts:
      - name: secret-files
        mountPath: /etc/secrets
        subPath: ""
        secretName: alertmanager-secrets
        readOnly: true
    config:
      receivers:
        - name: default-receiver
          slack_configs:
            - channel: '#test-01'
              send_resolved: true
              api_url_file: /etc/secrets/slack-api-url
              text: '{{ template "slack-message-description" . }}'
    templates:
      alertmanager.tmpl: |-
        {{ define "slack-message-title" }}
        [{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ end }}] {{ .CommonLabels.alertname }} for {{ .CommonLabels.job }}
        {{- if gt (len .CommonLabels) (len .GroupLabels) -}}
          {{" "}}(
          {{- with .CommonLabels.Remove .GroupLabels.Names }}
            {{- range $index, $label := .SortedPairs -}}
              {{ if $index }}, {{ end }}
              {{- $label.Name }}="{{ $label.Value -}}"
            {{- end }}
          {{- end -}}
          )
        {{- end }}
        {{end}}

        {{ define "slack-message-description" }}
        {{ range .Alerts -}}
        *Alert:* {{ .Annotations.title }}{{ if .Labels.severity }} - `{{ .Labels.severity }}`{{ end }}

        *Description:* {{ .Annotations.description }}

        *Details:*
          {{ range .Labels.SortedPairs }} â€¢ *{{ .Name }}:* `{{ .Value }}`
          {{ end }}
        {{ end }}
        {{end}}
