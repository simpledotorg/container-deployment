apiVersion: datadoghq.com/v1alpha1
kind: DatadogAgent
metadata:
  name: datadog-agent
  namespace: datadog
spec:
  credentials:
    apiSecret:
      secretName: datadog
      keyName: api-key
    appSecret:
      secretName: datadog
      keyName: app-key
  agent:
    image:
      name: gcr.io/datadoghq/agent:7.42.2
    apm:
      enabled: true
    log:
      enabled: true
      logsConfigContainerCollectAll: true
    env:
      - name: DD_ENV
        value: "qa"
    config:
      env:
        - name: DD_ENV
          value: "qa"
    process:
      env:
        - name: DD_ENV
          value: "qa"
  clusterAgent:
    image:
      name: gcr.io/datadoghq/agent:7.42.2
    config:
      externalMetrics:
      clusterChecksEnabled: true
  clusterName: "qa"
  features:
    prometheusScrape:
      enabled: true
      serviceEndpoints: true
